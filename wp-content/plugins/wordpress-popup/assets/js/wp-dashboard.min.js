!function(t){"use strict";({$widget:t(".hustle-widget"),activeModuleType:"",activeDisplayType:"total",activeTrackingType:"conversion",activeDaysRange:"7",trackingData:{},totalsData:{},daysLabels:[],theChart:null,init:function(){var t=this;this.$widget.find("#hustle-analytics-apply").on("click",function(e){return t.trackingAndDaysUpdated(e)}),this.$widget.find(".hustle-options-chart .hustle-option").on("click",function(e){return t.moduleTypeSelected(e)}),this.$widget.find(".hustle-options-embed .hustle-option").on("click",function(e){return t.displayTypeSelected(e)}),this.setDaysLabels(),this.setModuleType(this.$widget.find(".hustle-options-chart .hustle-option.hustle-active").data("module-type")),this.retrieveData()},trackingAndDaysUpdated:function(t){t.preventDefault();var e=this.activeDaysRange;if(this.activeTrackingType=this.$widget.find("#hustle-analytics-show").val(),this.activeDaysRange=this.$widget.find("#hustle-analytics-data").val(),this.setDaysLabels(),e===this.activeDaysRange)return this.buildChart(),void this.updateTotals();this.retrieveData()},setDaysLabels:function(){var t=-1*this.activeDaysRange;this.daysLabels=hustleVars.days_labels.slice(t)},retrieveData:function(){var e=this,i=this.$widget.data("nonce"),a=this.$widget.find(".hustle-message-empty"),s={_ajax_nonce:i,action:"hustle_get_wp_dashboard_widget_data",days:this.activeDaysRange,trackingType:this.activeTrackingType};t.ajax({url:ajaxurl,type:"POST",data:s,success:function(t){t.success&&t.data?(e.trackingData=t.data.data,e.totalsData=t.data.totals,e.buildChart(),e.updateTotals()):a.show()},error:function(){a.show()}})},moduleTypeSelected:function(e){var i=t(e.currentTarget),a=i.data("moduleType");this.setModuleType(a)&&(this.markButtonAsSelected(i),this.buildChart())},setModuleType:function(t){var e=this.$widget.find(".hustle-options-embed");if(["slidein","popup","overall"].includes(t))e.hide();else if("social_sharing"===t)e.show(),e.find('[data-display-type="floating"]').show();else{if("embedded"!==t)return!1;e.show(),e.find('[data-display-type="floating"]').hide()}return this.activeModuleType=t,this.buildTrackingActionSelect(),!0},displayTypeSelected:function(e){if(["embedded","social_sharing"].includes(this.activeModuleType)){var i=t(e.currentTarget),a=i.data("displayType");"floating"===a&&"social_sharing"!==this.activeModuleType||(this.markButtonAsSelected(i),this.activeDisplayType=a,this.buildChart())}},markButtonAsSelected:function(t){t.siblings(".hustle-option").removeClass("hustle-active").attr("aria-selected",!1),t.addClass("hustle-active").attr("aria-selected",!0)},buildTrackingActionSelect:function(){var t=this.$widget.find("#hustle-analytics-show"),e=["popup","slidein","embedded"],i=!hustleVars.active_module_types.some(function(t){return e.includes(t)}),a="",s=Object.assign({},hustleVars.tracking_actions);for(var n in("social_sharing"===this.activeModuleType||i)&&(delete s.cta_conversion,delete s.optin_conversion,"cta_conversion"!==this.activeTrackingType&&"optin_conversion"!==this.activeTrackingType||(this.activeTrackingType="view")),s){var o=n===this.activeTrackingType?"selected":"";a+='<option value="'.concat(n,'" ').concat(o,">").concat(s[n],"</option>")}t.html(a)},updateTotals:function(){var t=this.totalsData,e=function(t){return'<span class="sui-icon-arrow-'.concat(t,' sui-sm" aria-hidden="true"></span>')};for(var i in t){var a=this.$widget.find('.hustle-options-chart .hustle-option[data-module-type="'.concat(i,'"]')),s=a.find(".hustle-option--value"),n=a.find(".hustle-option--trend"),o=t[i],l=o[this.activeTrackingType].total,r=o[this.activeTrackingType].trend,d="";n.removeClass("hustle-up"),n.removeClass("hustle-down"),0!==r&&(0<r?(n.addClass("hustle-up"),d+=e("up")):(n.addClass("hustle-down"),d+=e("down"))),s.text(l),d+=r+"%",n.html(d)}},formatDataForChart:function(){var t=this.trackingData,e=this.activeModuleType,i=this.activeDisplayType,a=this.activeTrackingType,s=this.$widget.find(".hustle-message-empty"),n={},o={},l=e,r=!1;try{if(["popup","slidein","overall"].includes(e)||"total"===i)n=t[l];else{if("floating"===i&&"social_sharing"!==e)throw!1;n=t[l=e+"_"+i]}if(void 0===n)throw!1;if(r=0===this.totalsData.overall.view.total&&0===this.totalsData.overall.conversion.total,!n||!Object.keys(n).length)throw!1;if(void 0===(o=n[a])||!Object.keys(o).length)throw!1;o=Object.values(o)}catch(t){r=!0,o=Array(parseInt(this.activeDaysRange)).fill(0)}return r?s.show():s.hide(),o},buildChart:function(){var t=this.formatDataForChart(),e=[{label:hustleVars.tracking_actions[this.activeTrackingType],data:t,backgroundColor:["transparent"],borderColor:["#0085BA"],borderWidth:2,pointRadius:0,pointHitRadius:20,pointHoverRadius:4,pointHoverBorderColor:"#0085BA",pointHoverBackgroundColor:"#FFFFFF"}];this.theChart&&this.theChart.destroy(),this.createNewChart(e)},createNewChart:function(t){var e=this.$widget.find("#hustle-analytics-chart"),i=hustleVars.tracking_actions[this.activeTrackingType],a={labels:this.daysLabels,datasets:t},s={responsive:!0,maintainAspectRatio:!1,legend:{display:!1},scales:{yAxes:[{gridLines:{display:!0,color:"#F8F8F8",zeroLineColor:"#F8F8F8",drawBorder:!1},ticks:{fontColor:"#72777C",fontSize:11}}],xAxes:[{gridLines:{display:!1,zeroLineColor:"rgba(0,0,0,0)",drawBorder:!1},ticks:{fontColor:"#72777C",fontSize:11}}]},elements:{line:{tension:0},point:{radius:.5}},tooltips:{xPadding:12,yPadding:8,backgroundColor:"#333333",titleFontColor:"#FFFFFF",titleFontSize:15,titleFontFamily:"Roboto",titleFontStyle:"normal",titleAlign:"left",titleSpacing:0,titleMarginBottom:2,bodyFontColor:"#AAAAAA",bodyFontSize:11,bodyFontFamily:"Roboto",bodyFontStyle:"normal",bodyAlign:"left",cornerRadius:4,displayColors:!1,callbacks:{title:function(t){return t[0].yLabel+" "+i},label:function(t){return t.xLabel}}}};this.theChart=new Chart(e[0],{type:"line",fill:"start",data:a,options:s})}}).init()}(jQuery);